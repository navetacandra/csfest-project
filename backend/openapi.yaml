openapi: 3.0.0
info:
  title: Ku-LMSin API
  description: API for Ku-LMSin - University Learning Management System
  version: 1.0.0
  contact:
    name: API Support
    email: contact@juraganweb.web.id
servers:
  - url: http://localhost:5000/api
    description: Local development server
  - url: https://kulmsin.juraganweb.web.id/api
    description: Production server

paths:
  /login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and return JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: "testuser"
                password:
                  type: string
                  example: "password123"
      responses:
        "200":
          description: Successful login
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                        example: "eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9..."
                      role:
                        type: string
                        enum: [admin, dosen, mahasiswa]
                        example: "mahasiswa"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 401
                  error:
                    type: object
                    properties:
                      message:
                        type: string
                        example: "Invalid username or password"
                      code:
                        type: string
                        example: "AUTHENTICATION_FAILED"

  /logout:
    delete:
      tags:
        - Authentication
      summary: User logout
      description: Invalidate user session
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successful logout
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: object
                    example: {}

  /profile:
    get:
      tags:
        - Authentication
      summary: Get user profile
      description: Get details of authenticated user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User profile details
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                        example: 1
                      username:
                        type: string
                        example: "testuser"
                      name:
                        type: string
                        example: "Test User"
                      email:
                        type: string
                        example: "test@example.com"
                      nip:
                        type: string
                        example: "1234567890"
                      nim:
                        type: string
                        example: "235150200111001"
                      role:
                        type: string
                        enum: [admin, dosen, mahasiswa]
                        example: "mahasiswa"

  /news:
    get:
      tags:
        - News
      summary: Get public news list
      description: Retrieve paginated list of news (with id, title, and thumbnail only)
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
          description: Page number
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 10
          description: Number of items per page
      responses:
        "200":
          description: List of news articles (id, title, and thumbnail only)
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/NewsListItem"
                  meta:
                    $ref: "#/components/schemas/PaginationMeta"

  /news/{id}:
    get:
      tags:
        - News
      summary: Get specific news
      description: Retrieve details of a specific news article
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: News ID
      responses:
        "200":
          description: News details
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/News"

  /dashboard:
    get:
      tags:
        - General
      summary: Get dashboard data
      description: Retrieve user dashboard summary
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Dashboard data
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: object
                    properties:
                      news:
                        type: array
                        items:
                          $ref: "#/components/schemas/NewsListItem"
                      schedule:
                        type: array
                        items:
                          $ref: "#/components/schemas/Class"
                      tasks:
                        type: array
                        items:
                          $ref: "#/components/schemas/TaskItem"
                      classes:
                        type: array
                        items:
                          $ref: "#/components/schemas/Class"

  /classes:
    get:
      tags:
        - Class
      summary: Get followed classes
      description: Retrieve list of classes the user is enrolled in
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of classes
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Class"
    post:
      tags:
        - Class
      summary: Enroll in class
      description: Enroll in a class using enrollment key
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - enroll_key
              properties:
                enroll_key:
                  type: string
                  example: "ABC123DEF"
      responses:
        "200":
          description: Successfully enrolled in class
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Class"

  /classes/{id}:
    get:
      tags:
        - Class
      summary: Get class details
      description: Retrieve details of a specific class and its posts
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Class ID
      responses:
        "200":
          description: Class details with posts
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                        example: 1
                      name:
                        type: string
                        example: "Pemrograman Web Lanjutan"
                      enroll_key:
                        type: string
                        example: "WEB2025ADV"
                      schedule:
                        type: integer
                        example: 1
                      start_time:
                        type: string
                        example: "08:00"
                      end_time:
                        type: string
                        example: "10:00"
                      activated_at:
                        type: string
                        example: "2024-11-23T10:00:00Z"
                      created_at:
                        type: string
                        example: "2024-11-23T10:00:00Z"
                      updated_at:
                        type: string
                        example: "2024-11-23T10:00:00Z"
                      posts:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: number
                              example: 1
                            message:
                              type: string
                              example: "Selamat datang di kelas Pemrograman Web Lanjutan"
                            type:
                              type: string
                              example: "post"

  /classes/{class_id}/posts:
    post:
      tags:
        - Posts
      summary: Create post in class
      description: Create a new post or task in a class with optional file attachment
      security:
        - bearerAuth: []
      parameters:
        - name: class_id
          in: path
          required: true
          schema:
            type: integer
          description: Class ID
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - message
                - type
              properties:
                message:
                  type: string
                  example: "Tugas 1: Buat sebuah landing page sederhana menggunakan HTML & CSS"
                type:
                  type: string
                  enum: [post, task]
                  example: "task"
                file:
                  type: string
                  format: binary
                  description: Optional file attachment for the post
      responses:
        "200":
          description: Successfully created post
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Post"

  /classes/{class_id}/posts/{id}:
    get:
      tags:
        - Posts
      summary: Get post details
      description: Retrieve details of a specific post
      security:
        - bearerAuth: []
      parameters:
        - name: class_id
          in: path
          required: true
          schema:
            type: integer
          description: Class ID
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Post ID
      responses:
        "200":
          description: Post details
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/PostWithFile"
    put:
      tags:
        - Posts
      summary: Update post
      description: Update an existing post with optional file attachment
      security:
        - bearerAuth: []
      parameters:
        - name: class_id
          in: path
          required: true
          schema:
            type: integer
          description: Class ID
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Post ID
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: "Updated message"
                type:
                  type: string
                  enum: [post, task]
                  example: "post"
                file:
                  type: string
                  format: binary
                  description: Optional file attachment for the post
      responses:
        "200":
          description: Post updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Post"
    delete:
      tags:
        - Posts
      summary: Delete post
      description: Delete a specific post
      security:
        - bearerAuth: []
      parameters:
        - name: class_id
          in: path
          required: true
          schema:
            type: integer
          description: Class ID
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Post ID
      responses:
        "200":
          description: Post deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Post"

  /classes/{class_id}/posts/{post_id}/task:
    post:
      tags:
        - Tasks
      summary: Submit task
      description: Submit a completed task file
      security:
        - bearerAuth: []
      parameters:
        - name: class_id
          in: path
          required: true
          schema:
            type: integer
          description: Class ID
        - name: post_id
          in: path
          required: true
          schema:
            type: integer
          description: Post ID
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Task file to submit
      responses:
        "200":
          description: Task submitted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Task"

  /tasks:
    get:
      tags:
        - Tasks
      summary: Get user tasks
      description: Retrieve list of tasks for the user
      security:
        - bearerAuth: []
      parameters:
        - name: filter
          in: query
          required: false
          schema:
            type: string
            enum: [all, completed, incoming]
            default: "all"
          description: Filter tasks by status
      responses:
        "200":
          description: List of tasks
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/TaskItem"

  /schedule:
    get:
      tags:
        - Schedule
      summary: Get user schedule
      description: Retrieve schedule of classes the user is enrolled in
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User schedule
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Class"

  /presence/{class_id}:
    post:
      tags:
        - Presence
      summary: Set presence
      description: Record attendance for a class. For mahasiswa, can only set own presence for today as "hadir" with no late time. For dosen, can set presence for multiple students using an array payload.
      security:
        - bearerAuth: []
      parameters:
        - name: class_id
          in: path
          required: true
          schema:
            type: integer
          description: Class ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  description: For mahasiswa - set own presence (only date and status are ignored, sets for today automatically)
                  additionalProperties: false
                - type: array
                  description: For dosen - set presence for multiple students
                  items:
                    type: object
                    required:
                      - schedule_date
                      - status
                      - studentId
                    properties:
                      schedule_date:
                        type: string
                        format: date
                        example: "2024-11-24"
                      status:
                        type: string
                        enum: [hadir, izin, sakit, alpha]
                        example: "hadir"
                      studentId:
                        type: integer
                        description: Student ID for whom to set presence
                        example: 123
                      late_time:
                        type: integer
                        description: Late time in minutes, default 0
                        example: 5
      responses:
        "200":
          description: Presence recorded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: object
                    example: {}
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 400
                  error:
                    type: object
                    properties:
                      message:
                        type: string
                        example: "Mahasiswa cannot set presence for other students or specify lateness."
                      code:
                        type: string
                        example: "VALIDATION_ERROR"
        "404":
          description: Class or student not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 404
                  error:
                    type: object
                    properties:
                      message:
                        type: string
                        example: "Class not found"
                      code:
                        type: string
                        example: "NOT_FOUND"

  /presence/recap:
    get:
      tags:
        - Presence
      summary: Get presence recap for mahasiswa
      description: Retrieve presence records and accumulated lateness for a student across all classes
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Mahasiswa presence recap
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: object
                    properties:
                      lateness_time:
                        type: number
                        example: 15
                        description: Total accumulated lateness time in minutes
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            class_id:
                              type: number
                              example: 1
                            class_name:
                              type: string
                              example: "Pemrograman Web Lanjutan"
                            recap:
                              type: array
                              items:
                                type: object
                                properties:
                                  schedule_date:
                                    type: string
                                    format: date
                                    example: "2025-01-01"
                                  status:
                                    type: string
                                    enum: [hadir, izin, sakit, alpha, null]
                                    example: "hadir"
                                    description: null if no presence record exists
                                  late_time:
                                    type: number
                                    example: 5
                                    description: 0 if no presence record exists
  /presence/{class_id}/recap:
    get:
      tags:
        - Presence
      summary: Get presence recap for dosen
      description: Retrieve presence records for all students in a specific class
      security:
        - bearerAuth: []
      parameters:
        - name: class_id
          in: path
          required: true
          schema:
            type: integer
          description: Class ID
      responses:
        "200":
          description: Dosen presence recap for a class
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: object
                    properties:
                      members:
                        type: array
                        items:
                          type: object
                          properties:
                            mahasiswa_id:
                              type: number
                              example: 1
                            nim:
                              type: string
                              example: "235150200111001"
                            name:
                              type: string
                              example: "Agus Setiawan"
                      recap:
                        type: array
                        items:
                          type: object
                          properties:
                            schedule_date:
                              type: string
                              format: date
                              example: "2025-01-01"
                            data:
                              type: array
                              items:
                                type: object
                                properties:
                                  mahasiswa_id:
                                    type: number
                                    example: 1
                                  status:
                                    type: string
                                    enum: [hadir, izin, sakit, alpha, null]
                                    example: "hadir"
                                    description: null if no presence record exists
                                  late_time:
                                    type: number
                                    example: 5
                                    description: 0 if no presence record exists

  /admin/major:
    get:
      tags:
        - Admin
      summary: Get list of majors
      description: Retrieve all majors (admin only)
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of majors
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Major"
    post:
      tags:
        - Admin
      summary: Create major
      description: Create a new major (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: "Ilmu Komputer"
      responses:
        "200":
          description: Major created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Major"

  /admin/major/{id}:
    get:
      tags:
        - Admin
      summary: Get major details
      description: Retrieve details of a specific major (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Major ID
      responses:
        "200":
          description: Major details
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Major"
    put:
      tags:
        - Admin
      summary: Update major
      description: Update an existing major (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Major ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Informatika"
      responses:
        "200":
          description: Major updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Major"
    delete:
      tags:
        - Admin
      summary: Delete major
      description: Delete a specific major (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Major ID
      responses:
        "200":
          description: Major deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Major"

  /admin/major/{major_id}/study_program:
    get:
      tags:
        - Admin
      summary: Get study programs for major
      description: Retrieve all study programs for a specific major (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: major_id
          in: path
          required: true
          schema:
            type: integer
          description: Major ID
      responses:
        "200":
          description: List of study programs
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/StudyProgram"
    post:
      tags:
        - Admin
      summary: Create study program
      description: Create a new study program for a major (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: major_id
          in: path
          required: true
          schema:
            type: integer
          description: Major ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: "Teknik Informatika"
      responses:
        "200":
          description: Study program created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/StudyProgram"

  /admin/study_program/{id}:
    get:
      tags:
        - Admin
      summary: Get study program details
      description: Retrieve details of a specific study program (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Study Program ID
      responses:
        "200":
          description: Study program details
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/StudyProgram"
    put:
      tags:
        - Admin
      summary: Update study program
      description: Update an existing study program (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Study Program ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Sistem Informasi"
      responses:
        "200":
          description: Study program updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/StudyProgram"
    delete:
      tags:
        - Admin
      summary: Delete study program
      description: Delete a specific study program (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Study Program ID
      responses:
        "200":
          description: Study program deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/StudyProgram"

  /admin/study_program/{study_program_id}/mahasiswa:
    get:
      tags:
        - Admin
      summary: Get students in a study program
      description: Retrieve all students in a specific study program (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: study_program_id
          in: path
          required: true
          schema:
            type: integer
          description: Study Program ID
      responses:
        "200":
          description: List of students in the study program
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Mahasiswa"

    post:
      tags:
        - Admin
      summary: Create student in study program
      description: Create a new student in a specific study program (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: study_program_id
          in: path
          required: true
          schema:
            type: integer
          description: Study Program ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - major_id
                - nim
                - name
                - email
                - username
                - password
              properties:
                major_id:
                  type: integer
                  example: 1
                nim:
                  type: string
                  example: "235150200111001"
                name:
                  type: string
                  example: "Agus Setiawan"
                email:
                  type: string
                  format: email
                  example: "agus.s@student.college.id"
                username:
                  type: string
                  example: "agus.setiawan"
                password:
                  type: string
                  example: "password123"
      responses:
        "200":
          description: Student created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Mahasiswa"

  /admin/mahasiswa/{id}:
    get:
      tags:
        - Admin
      summary: Get student details
      description: Retrieve details of a specific student (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Student ID
      responses:
        "200":
          description: Student details
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Mahasiswa"
    put:
      tags:
        - Admin
      summary: Update student
      description: Update an existing student (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Student ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                major_id:
                  type: integer
                  example: 1
                study_program_id:
                  type: integer
                  example: 1
                nim:
                  type: string
                  example: "235150200111001"
                name:
                  type: string
                  example: "Agus Setiawan"
                email:
                  type: string
                  format: email
                  example: "agus.s@student.college.id"
                username:
                  type: string
                  example: "agus.setiawan"
                password:
                  type: string
                  example: "newpassword123"
      responses:
        "200":
          description: Student updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Mahasiswa"
    delete:
      tags:
        - Admin
      summary: Delete student
      description: Delete a specific student (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Student ID
      responses:
        "200":
          description: Student deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Mahasiswa"

  /admin/class:
    get:
      tags:
        - Admin
      summary: Get all classes
      description: Retrieve all classes (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
          description: Page number
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 10
          description: Number of items per page
      responses:
        "200":
          description: List of all classes
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Class"
                  meta:
                    $ref: "#/components/schemas/PaginationMeta"
    post:
      tags:
        - Admin
      summary: Create class
      description: Create a new class (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - schedule
                - start_time
                - end_time
              properties:
                name:
                  type: string
                  example: "Pemrograman Web Lanjutan"
                schedule:
                  type: integer
                  description: Day of week (0=Sunday, 1=Monday, ..., 6=Saturday)
                  example: 1
                start_time:
                  type: string
                  example: "08:00"
                end_time:
                  type: string
                  example: "10:00"
                activated_at:
                  type: string
                  format: date-time
                  example: "2025-01-01 00:00:00"
      responses:
        "200":
          description: Class created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Class"

  /admin/class/{id}:
    get:
      tags:
        - Admin
      summary: Get class details
      description: Retrieve details of a specific class (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Class ID
      responses:
        "200":
          description: Class details
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Class"
    put:
      tags:
        - Admin
      summary: Update class
      description: Update an existing class (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Class ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Pemrograman Web Lanjutan"
                schedule:
                  type: integer
                  description: Day of week (0=Sunday, 1=Monday, ..., 6=Saturday)
                  example: 1
                start_time:
                  type: string
                  example: "08:00"
                end_time:
                  type: string
                  example: "10:00"
                activated_at:
                  type: string
                  format: date-time
                  example: "2025-01-01 00:00:00"
      responses:
        "200":
          description: Class updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Class"
    delete:
      tags:
        - Admin
      summary: Delete class
      description: Delete a specific class (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Class ID
      responses:
        "200":
          description: Class deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Class"

  /admin/dosen:
    get:
      tags:
        - Admin
      summary: Get all lecturers
      description: Retrieve all lecturers (admin only)
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of all lecturers
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Dosen"
    post:
      tags:
        - Admin
      summary: Create lecturer
      description: Create a new lecturer (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - nip
                - name
                - username
                - password
              properties:
                nip:
                  type: string
                  example: "198501012010011001"
                name:
                  type: string
                  example: "Dr. Budi Hartono, M.Kom."
                username:
                  type: string
                  example: "budi.hartono"
                password:
                  type: string
                  example: "password123"
      responses:
        "200":
          description: Lecturer created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Dosen"

  /admin/dosen/{id}:
    get:
      tags:
        - Admin
      summary: Get lecturer details
      description: Retrieve details of a specific lecturer (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Lecturer ID
      responses:
        "200":
          description: Lecturer details
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Dosen"
    put:
      tags:
        - Admin
      summary: Update lecturer
      description: Update an existing lecturer (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Lecturer ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nip:
                  type: string
                  example: "198501012010011001"
                name:
                  type: string
                  example: "Dr. Budi Hartono, M.Kom."
                username:
                  type: string
                  example: "budi.hartono"
                password:
                  type: string
                  example: "newpassword123"
      responses:
        "200":
          description: Lecturer updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Dosen"
    delete:
      tags:
        - Admin
      summary: Delete lecturer
      description: Delete a specific lecturer (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Lecturer ID
      responses:
        "200":
          description: Lecturer deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/Dosen"

  /admin/news:
    get:
      tags:
        - Admin
      summary: Get all news (admin)
      description: Retrieve paginated list of news (admin only) (with id, title, and thumbnail only)
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
          description: Page number
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 10
          description: Number of items per page
      responses:
        "200":
          description: List of news articles (id, title, and thumbnail only)
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/NewsListItem"
                  meta:
                    $ref: "#/components/schemas/PaginationMeta"
    post:
      tags:
        - Admin
      summary: Create news
      description: Create a new news article with thumbnail (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - title
                - content
                - thumbnail
              properties:
                title:
                  type: string
                  example: "Pembukaan Pendaftaran Semester Baru 2025/2026"
                content:
                  type: string
                  example: "Telah dibuka pendaftaran untuk semester baru tahun ajaran 2025/2026..."
                thumbnail:
                  type: string
                  format: binary
                  description: News thumbnail image file
      responses:
        "200":
          description: News created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/News"

  /admin/news/{id}:
    get:
      tags:
        - Admin
      summary: Get news details (admin)
      description: Retrieve details of a specific news article (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: News ID
      responses:
        "200":
          description: News details
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/News"
    put:
      tags:
        - Admin
      summary: Update news
      description: Update an existing news article with optional new thumbnail (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: News ID
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: "Updated News Title"
                content:
                  type: string
                  example: "Updated news content..."
                thumbnail:
                  type: string
                  format: binary
                  description: Optional new news thumbnail image file
      responses:
        "200":
          description: News updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/News"
    delete:
      tags:
        - Admin
      summary: Delete news
      description: Delete a specific news article (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: News ID
      responses:
        "200":
          description: News deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: number
                    example: 200
                  data:
                    $ref: "#/components/schemas/News"

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    NewsListItem:
      type: object
      properties:
        id:
          type: number
          example: 1
        title:
          type: string
          example: "Pembukaan Pendaftaran Semester Baru 2025/2026"
        thumbnail_file_id:
          type: number
          example: 5
        created_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"

    News:
      type: object
      properties:
        id:
          type: number
          example: 1
        title:
          type: string
          example: "Pembukaan Pendaftaran Semester Baru 2025/2026"
        thumbnail_file_id:
          type: number
          example: 5
        content:
          type: string
          example: "Telah dibuka pendaftaran untuk semester baru tahun ajaran 2025/2026. Segera lakukan pendaftaran ulang melalui portal akademik."
        created_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"

    Class:
      type: object
      properties:
        id:
          type: number
          example: 1
        name:
          type: string
          example: "Pemrograman Web Lanjutan"
        enroll_key:
          type: string
          example: "WEB2025ADV"
        schedule:
          type: integer
          description: Day of week (0=Sunday, 1=Monday, ..., 6=Saturday)
          example: 1
        start_time:
          type: string
          example: "08:00"
        end_time:
          type: string
          example: "10:00"
        activated_at:
          type: string
          example: "2024-11-23T10:00:00Z"
        created_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        posts:
          type: array
          items:
            type: object
            properties:
              id:
                type: number
                example: 1
              message:
                type: string
                example: "Selamat datang di kelas Pemrograman Web Lanjutan"
              type:
                type: string
                example: "post"

    Post:
      type: object
      properties:
        id:
          type: number
          example: 1
        class_id:
          type: number
          example: 1
        class_enrollment_id:
          type: number
          example: 1
        file_id:
          type: number
          example: null
        message:
          type: string
          example: "Selamat datang di kelas Pemrograman Web Lanjutan"
        type:
          type: string
          enum: [post, task]
          example: "post"
        created_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"

    PostWithFile:
      allOf:
        - $ref: "#/components/schemas/Post"
        - type: object
          properties:
            file:
              $ref: "#/components/schemas/File"

    Task:
      type: object
      properties:
        id:
          type: number
          example: 1
        post_id:
          type: number
          example: 3
        class_enrollment_id:
          type: number
          example: 7
        file_id:
          type: number
          example: 1
        created_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"

    TaskItem:
      type: object
      properties:
        id:
          type: number
          example: 1
        class_id:
          type: number
          example: 1
        class_name:
          type: string
          example: "Pemrograman Web Lanjutan"
        title:
          type: string
          example: "Tugas 1: Buat sebuah landing page sederhana"
        status:
          type: string
          enum: [completed, incoming]
          example: "incoming"

    File:
      type: object
      properties:
        id:
          type: number
          example: 1
        mahasiswa_id:
          type: number
          example: 1
        dosen_id:
          type: number
          example: null
        upload_name:
          type: string
          example: "tugas_1.pdf"
        random_name:
          type: string
          example: "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6.pdf"
        size:
          type: number
          example: 1024
        mimetype:
          type: string
          example: "application/pdf"
        created_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"

    Major:
      type: object
      properties:
        id:
          type: number
          example: 1
        name:
          type: string
          example: "Ilmu Komputer"
        created_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"

    StudyProgram:
      type: object
      properties:
        id:
          type: number
          example: 1
        major_id:
          type: number
          example: 1
        name:
          type: string
          example: "Teknik Informatika"
        created_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"

    Mahasiswa:
      type: object
      properties:
        id:
          type: number
          example: 1
        major_id:
          type: number
          example: 1
        study_program_id:
          type: number
          example: 1
        nim:
          type: string
          example: "235150200111001"
        name:
          type: string
          example: "Agus Setiawan"
        email:
          type: string
          format: email
          example: "agus.s@student.college.id"
        username:
          type: string
          example: "agus.setiawan"
        created_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"

    Dosen:
      type: object
      properties:
        id:
          type: number
          example: 1
        nip:
          type: string
          example: "198501012010011001"
        name:
          type: string
          example: "Dr. Budi Hartono, M.Kom."
        username:
          type: string
          example: "budi.hartono"
        created_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"

    Admin:
      type: object
      properties:
        id:
          type: number
          example: 1
        name:
          type: string
          example: "Super Admin"
        username:
          type: string
          example: "superadmin"
        created_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"

    PaginationMeta:
      type: object
      properties:
        size:
          type: number
          example: 10
        page:
          type: number
          example: 1
        limit:
          type: number
          example: 10

    Presence:
      type: object
      properties:
        id:
          type: number
          example: 1
        class_enrollment_id:
          type: number
          example: 7
        schedule_date:
          type: string
          format: date
          example: "2024-11-24"
        status:
          type: string
          enum: [hadir, sakit, izin, alpha]
          example: "hadir"
        late_time:
          type: number
          example: 0
        created_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-11-23T10:00:00Z"

    PresenceRecap:
      type: object
      properties:
        lateness_time:
          type: number
          example: 0
          description: Total accumulated lateness time in minutes
        data:
          type: array
          items:
            type: object
            properties:
              class_id:
                type: number
                example: 1
              class_name:
                type: string
                example: "Pemrograman Web Lanjutan"
              recap:
                type: array
                items:
                  type: object
                  properties:
                    schedule_date:
                      type: string
                      format: date
                      example: "2025-01-01"
                    status:
                      type: string
                      enum: [hadir, izin, sakit, alpha, null]
                      example: "hadir"
                      description: null if no presence record exists
                    late_time:
                      type: number
                      example: 5
                      description: 0 if no presence record exists
